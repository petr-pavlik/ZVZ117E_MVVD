# Bodový a intervalový odhad {#sec-odhad}

::: callout-warning
## Cíle cvičení 

- vlastnosti odhadu
- zákon velkých čísel
- bodový a intervalový odhad
- $t$-test
:::

Obecně je odhadem v matematické statistice nazýváno určení parametru rozdělení hodnoty určitého znaku **základního souboru** s pomocí **výběrového souboru**.

Obecné charakteristiky základního souboru značíme písmeny řecké abecedy (např. $\mu$, $\sigma$, $\ldots$), pro výběrové charakteristiky volíme analogická písmena z latinky ($\bar{x}, s_x, \ldots$).

## Vlastnosti odhadu

V mnoha situacích potřebujeme odhadnout určitý parametr (střední hodnotu, $90\%$ kvantil atp.) neznámé náhodné veličiny. Tento parametr odhadujeme pomocí nějaké statistiky výběru z této veličiny. Například odhadujeme střední hodnotu veličiny pomocí průměru. Abychom mohli určit hodnotu parametru (např. střední hodnotu) přesně, musel by být výběr nekonečně velký. Jelikož toto v praxi nenastane, náš odhad je vždy více či méně odlišný od skutečné hodnoty parametru (např. střední hodnoty) neznámé veličiny. Důležitou vlastností odhadu je nestrannost - o nestranném odhadu mluvíme pokud střední hodnota odhadu je rovna neznámému parametru.

V přednáškách o charakteristikách náhodné veličiny a jejich odhadech je zmíněna rovnice

$$
\dfrac{\sum\limits_{i=1}^{n}(x_i - \bar{x})^2}{n-1}
$$

jako nestranný odhad veličiny $X$. Z definice rozptylu $\mathbb{E}[(X - \mathbb{E}(X^2))]$ však vyplývá odhad

$$
\dfrac{\sum\limits_{i=1}^{n}(x_i - \bar{x})^2}{n}.
$$

::: callout-tip
## Cvičení

  1. Doplňte následující kód.\
```{r, eval=FALSE}
X <- data.frame()
for (i in 1:nsim) {
  x <- rnorm(n)
  s_unb <- 1/(n-1)
  s_bia <- 1/n
  s_unb2 <- 1/(n-1)
  s_bia2 <- 1/n
  X <- rbind(X, c(s_unb, s_bia, s_unb2, s_bia2))
}
names(X) = c('UNB', 'BIA' , 'UNB2' ,'BIA2')
```
  a) Napište funkce pro odhad ropztylu.\
  b) Zamyslete se, které proměnné nejsou určeny a doplňte je.\
  c) Spočtěte pro každou metodu průměrný odhad a systematickou chybu tohoto odhadu.\
  d) Který odhad je nejméně vychýlený a v jaké situaci?\
:::


### Zákon velkých čísel

Zákon velkých čísel popisuje skutečnost, že s rostoucím počtem opakování nezávislých náhodných pokusů se empirické charakteristiky (realizované výběrové odhady), které popisují výsledky těchto pokusů blíží k teoretickým charakteristikám.

::: callout-tip
## Úloha

  1. Generujte s pomocí funkce `rnorm` postupně $10$, $10^2$, $10^3$ čísel se shodnou střední hodnotou a shodným rozptylem. Spočítejte $\bar{x}$ a ${s^2}$, použijte nápovědu.
Okomentujte výsledky. 
```{r, echo=FALSE, fig.align='center', fig.width=10}
par(mfrow = c(1, 3))
set.seed(13)
x10 <- rnorm(10, 0, 1)
set.seed(13)
x100 <- rnorm(100, 0, 1)
set.seed(13)
x1000 <- rnorm(1000, 0, 1)
curve(dnorm(x, mean = 0 , sd = 1), from = -4, to = 4, xlab = "", ylab = "", main = "A)", cex.main = 2)
rug(x10, lwd = 2, col = "#00000025")
rug(mean(x10), lwd = 2, col = "orangered")
segments(x0 = mean(x10), y0 = 0, x1 = mean(x10), y1 = dnorm(mean(x10), 0, 1), col = "orangered")
segments(x0 = 0, y0 = 0, x1 = 0, y1 = dnorm(0, 0, 1), lty = "dashed", col = "gray25")
curve(dnorm(x, mean = 0 , sd = 1), from = -4, to = 4, xlab = "", ylab = "", main = "B)", cex.main = 2)
rug(x100, lwd = 2, col = "#00000025")
rug(mean(x100), lwd = 2, col = "orangered")
segments(x0 = mean(x100), y0 = 0, x1 = mean(x100), y1 = dnorm(mean(x100), 0, 1), col = "orangered")
segments(x0 = 0, y0 = 0, x1 = 0, y1 = dnorm(0, 0, 1), lty = "dashed", col = "gray25")
curve(dnorm(x, mean = 0 , sd = 1), from = -4, to = 4, xlab = "", ylab = "", main = "C)", cex.main = 2)
rug(x1000, lwd = 2, col = "#00000025")
rug(mean(x1000), lwd = 2, col = "orangered")
segments(x0 = mean(x1000), y0 = 0, x1 = mean(x1000), y1 = dnorm(mean(x1000), 0, 1), col = "orangered")
segments(x0 = 0, y0 = 0, x1 = 0, y1 = dnorm(0, 0, 1), lty = "dashed", col = "gray25")
```
:::

## Bodový odhad

Bodovým odhadem se se rozumí jednočíselná hodnota, která reprezentuje vybraný moment statistického souboru jako celek. Bodovým odhadem je například výběrový průměr nebo výběrový rozptyl.

```{r, collapse=TRUE}
set.seed(100)
x <- rnorm(10, 10, 10)
mean(x)
var(x)
```


### Odhad parametru $\mu$, neboli střední hodnoty normálního rozdělení s neznámým rozptylem

Takto formulovaný bodový a intervalový je jednou z nejčastěji prováděných úloh. Nejprve bodovým odhadem zjistíme **výběrový průměr** souboru.

```{r}
mean(x)
```

Vidíme, že $x =$ `r x`. Pro tento průmer následně spočítáme interval spolehlivosti.

## Intervalový odhad

V případech, kdy chceme znát polohu bodového odhadu s nějakou danou pravděpodobností, můžeme se pokusit zkonstruovat tzv. **intervalový odhad**. @eq-odhad-intervalovyodhad je rovnice pro intervalový odhad střední hodnoty při neznámém rozptylu.


$$ 
\bar{X} \pm \dfrac{s}{\sqrt{n}}t_{1-\alpha/2}(n-1)
$$ {#eq-odhad-intervalovyodhad}

$100(1-\alpha)\%$ interval spolehlivosti je rozmezí, ve kterém se usuzovaná hodnota základního souboru bude nacházet s určitou pravěděpodobností. Je tomu tak současně za předpokladu, že samotná poloha
hledaného parametru je konstantní.

```{r}
alpha <- 0.05
cbind(
  mean(x) - sd(x)/length(x)*qt(p = 1 - alpha/2, df = length(x) - 1),
  mean(x) + sd(x)/length(x)*qt(p = 1 - alpha/2, df = length(x) - 1)
)
```

## Maximálně věrohodný odhad

Maximálně věrohodný odhad je takový, který maximalizuje věrohodnostní funkci $L$ pro výběr $(x_1, x_2, \ldots, x_n)$

$$
L(\theta, x_1, x_2, \ldots, x_n) = p(x_1, \theta) \cdot p(x_2, \theta) \cdot \ldots p(x_n, \theta) = \prod\limits_{i=1}^{n}p(x_i, \theta)
$$ Konstrukce věrohodnostní funkce

### Maximálně věrohodný odhad pro normální rozdělení

Vjděme z pravděpodobnostní funkce normálního rozdělení s předpisem @eq-maxlike-normalni-rozdeleni, který 

$$
f(y|\mu, \sigma) = \dfrac{1}{\sigma\sqrt{2\pi}}\exp\left[-\dfrac{(y-\mu)^2}{2\sigma^2}\right]
$$ {#eq-maxlike-normalni-rozdeleni}

```{r}
mu <- 5 # <1>
sigma <- 1 # <1>

n <- 10000 # <2>
x <- rnorm(n, mu, sigma^2) # <2>

likelihood <- function(params) { # <3>
  mean_param <- params[1] # <3>
  sd_param <- params[2]# <3>
  return(prod(dnorm(x, mean = mean_param, sd = sd_param)))# <3>
}


result <- optim(par = c(5, 1), #<4>
                fn = function(params) -likelihood(params), #<4>
                hessian = TRUE) #<4>

mle_mean <- result$par[1] #<5>
mle_sd <- result$par[2] #<5>

cat("MLE pro střední hodnotu:", mle_mean, "\n")
cat("MLE pro směrodatnou odchylku:", mle_sd, "\n")

```
1. Skutečné parametry $\mu$ a $\sigma$, které použijeme ke generování náhodných čísel.
2. Získáme pseudonáhodná čísla z Normálního rozdělení.
3. Definice věrohodnostní funkce.
4. S použitím funkce `optim()` hledáme maximálně věrohodný odhad.
5. Získané hodnoty odhadů.

Spočítejte hodnotu věrohodnostní funkce pro $X = 4$

```{r}
n <- 10000
x <- rnorm(n, 5, 1)
L <- x*pnorm(x, mean = 5, sd = 1)
max(L)
boxplot(x)
curve(dnorm(x, 4, 1), xlim = c(0,8))
curve(dlnorm(x, 1, 0.5), add = TRUE)
```

## $t$-test {#ttest}
Testování hypotéz podrobněji probereme v @sec-testovani. Nyní si nicméně ukážeme, 
že výstupem funkce `t.test()` je rovněž intervalový odhad pro střední hodnotu Normálního
rozdělení při neznámém rozptylu.
Testovací statistika pro oboustrannou alternativu má hodnotu

$$
\dfrac{|\bar{x} - \mu_0|}{s}\sqrt{n} > t_{\alpha/2}(n-1)
$$ a pro jednostrannou alternativu $\mu > \mu_0$

$$
\dfrac{\bar{x} - \mu_0}{s}\sqrt{n} > t_{\alpha}(n-1)
$$ respektive

$$
\dfrac{\bar{x} - \mu_0}{s}\sqrt{n} < t_{\alpha}(n-1)
$$ pro $\mu < \mu_0$. $n-1$ je počet stupňů volnosti.

::: callout-tip
## Úloha

  1. Spočítejte pomocí funkce `t.test` intervalový odhad pro `x = rnorm(100)` a `set.seed(100)`.\
  2. Spočítejte, zda můžeme s pravděpodobností $90\:\%$ zamítnout hypotézu, že střední hodnota veličiny generující výběr `x <- c(0.77, 1.11, 1.14, 0.92, 0.49, 5.03, 1.35, 0.94, 0.33, 2.49)` je menší než 1.\
  3. Pro stejný výběr spočítejte, zda je možné na hladině významnosti $0.05$ zamítnout hypotézu, že střední hodnota veličiny generující výběr je rovna $1$.
:::